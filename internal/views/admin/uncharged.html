{{define "admin_uncharged.html"}}
{{template "layout_start" .}}
<h1>Productos sin precio / no cargados</h1>
<nav class="admin-nav"><a href="/admin/products">Productos</a> | <a href="/admin/orders">√ìrdenes</a> | <a href="/admin/sales">Ventas</a> | <a href="/admin/uncharged" class="active">Sin precio</a> | <a href="/admin/logout">Salir</a></nav>

<section class="admin-card" style="margin-top:1rem;padding:18px 20px 24px">
  <p style="margin:0 0 10px;color:var(--muted)">√öltima importaci√≥n: {{if .Report.Timestamp}}{{.Report.Timestamp}}{{else}}-{{end}}</p>
  <div class="row" style="gap:1rem;align-items:flex-start;flex-wrap:wrap">
    <div style="flex:1;min-width:320px">
      <h2 style="margin:0 0 8px;font-size:18px">Sin precio ({{len .Report.UnmatchedItems}} √∫nicos)</h2>
      {{if .Report.UnmatchedItems}}
      <table class="table" style="font-size:0.85rem">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Colores</th>
            <th>Raz√≥n</th>
          </tr>
        </thead>
        <tbody>
        {{range $nombre, $cantidad := .Report.UnmatchedItems}}
          <tr>
            <td style="font-family:monospace">{{$nombre}}</td>
            <td style="text-align:center">√ó{{$cantidad}}</td>
            <td>
              {{$razon := index $.Report.UnmatchedReasons $nombre}}
              {{if eq $razon "sin_stock"}}
                <span style="color:#f59e0b">üì¶ Sin Stock</span>
              {{else if eq $razon "no_encontrado"}}
                <span style="color:#ef4444">‚ùå No en precios</span>
              {{else if eq $razon "formato_diferente"}}
                <span style="color:#8b5cf6">üîÄ Formato diferente</span>
              {{else if eq $razon "precio_invalido"}}
                <span style="color:#6b7280">‚ö†Ô∏è Precio inv√°lido</span>
              {{else if eq $razon "openai_sin_precio"}}
                <span style="color:#06b6d4">ü§ñ OpenAI sin match</span>
              {{else}}
                <span style="color:var(--muted)">? Desconocido</span>
              {{end}}
            </td>
          </tr>
        {{end}}
        </tbody>
      </table>
      <div style="margin-top:12px;padding:12px;background:#f8f9fa;border-radius:6px;font-size:12px">
        <strong>Leyenda:</strong>
        <ul style="margin:6px 0 0;padding-left:20px">
          <li>üì¶ <strong>Sin Stock</strong>: Producto marcado como "Sin Stock" en el archivo de precios</li>
          <li>‚ùå <strong>No en precios</strong>: Producto no encontrado en el archivo de precios (agregar l√≠nea al TXT)</li>
          <li>üîÄ <strong>Formato diferente</strong>: Producto existe pero nombre no coincide (revisar formato)</li>
          <li>‚ö†Ô∏è <strong>Precio inv√°lido</strong>: Producto encontrado pero precio no parseado correctamente</li>
          <li>ü§ñ <strong>OpenAI sin match</strong>: OpenAI no pudo encontrar coincidencia</li>
        </ul>
      </div>
      {{else}}
      <p>No hay items sin precio.</p>
      {{end}}
    </div>
    <div style="flex:1;min-width:280px">
      <h2 style="margin:0 0 8px;font-size:18px">Productos creados ({{len .Report.CreatedProductSlugs}})</h2>
      {{if .Report.CreatedProductSlugs}}
      <ul>
        {{range .Report.CreatedProductSlugs}}
          <li><a href="/product/{{.}}" target="_blank" rel="noopener">{{.}}</a></li>
        {{end}}
      </ul>
      {{else}}<p>-</p>{{end}}
      <h3 style="margin:10px 0 6px">Actualizados ({{len .Report.UpdatedProductSlugs}})</h3>
      {{if .Report.UpdatedProductSlugs}}
      <ul>
        {{range .Report.UpdatedProductSlugs}}
          <li><a href="/product/{{.}}" target="_blank" rel="noopener">{{.}}</a></li>
        {{end}}
      </ul>
      {{else}}<p>-</p>{{end}}
    </div>
    <div style="flex:1;min-width:280px">
      <h2 style="margin:0 0 8px;font-size:18px">Variantes</h2>
      <h3 style="margin:0 0 6px">Creadas ({{len .Report.CreatedVariantKeys}})</h3>
      {{if .Report.CreatedVariantKeys}}
      <ul>
        {{range .Report.CreatedVariantKeys}}
          <li style="font-family:monospace">{{.}}</li>
        {{end}}
      </ul>
      {{else}}<p>-</p>{{end}}
      <h3 style="margin:10px 0 6px">Actualizadas ({{len .Report.UpdatedVariantKeys}})</h3>
      {{if .Report.UpdatedVariantKeys}}
      <ul>
        {{range .Report.UpdatedVariantKeys}}
          <li style="font-family:monospace">{{.}}</li>
        {{end}}
      </ul>
      {{else}}<p>-</p>{{end}}
    </div>
  </div>
  {{if .Report.UnmatchedItems}}
  <ul>
    {{range .Report.UnmatchedItems}}
      <li style="font-family:monospace">{{.}}</li>
    {{end}}
  </ul>
  {{else}}
  <p>No hay items pendientes o la importaci√≥n a√∫n no se ejecut√≥.</p>
  {{end}}

  {{if .Report.Errors}}
  <h3 style="margin:16px 0 6px">Errores</h3>
  <ul>
    {{range .Report.Errors}}
      <li>{{.}}</li>
    {{end}}
  </ul>
  {{end}}
</section>

{{template "layout_end" .}}
{{end}}


